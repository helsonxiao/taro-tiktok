(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"116":function(e,t,n){},"121":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return k}));var a=n(2),c=n(3),i=n(12),r=n(8),o=n(9),s=n(4),u=n(98),d=n(13),l=n.n(d),f=n(30),m=n(117),v=(n(116),n(99)),h=Object(f.getSystemInfoSync)().windowWidth/3-4,p=16*h/9,k=function(e){Object(r.a)(Index,e);var t=Object(o.a)(Index);function Index(){var e;Object(a.a)(this,Index);for(var n=arguments.length,c=new Array(n),r=0;r<n;r++)c[r]=arguments[r];return e=t.call.apply(t,[this].concat(c)),Object(s.a)(Object(i.a)(e),"state",{"userInfo":{"nickname":""},"nicknameModalVisible":!1,"nicknameInput":"","favVideos":[]}),Object(s.a)(Object(i.a)(e),"refreshVideos",(function(){Object(v.b)().then((function(t){return e.setState({"favVideos":t})}))})),Object(s.a)(Object(i.a)(e),"refreshUserInfo",(function(){Object(v.c)().then((function(t){e.setState({"userInfo":t})}))})),e}return Object(c.a)(Index,[{"key":"componentDidMount","value":function componentDidMount(){this.refreshVideos(),this.refreshUserInfo()}},{"key":"onTabItemTap","value":function onTabItemTap(){this.refreshVideos(),this.refreshUserInfo()}},{"key":"render","value":function render(){var e=this;return l.a.createElement(u.View,{"className":"user-center"},l.a.createElement(u.View,{"className":"wallpaper"}),l.a.createElement(u.View,{"className":"user-info","onClick":function onClick(){return e.setState({"nicknameModalVisible":!0})}},l.a.createElement(u.Text,{"className":"nickname"},this.state.userInfo.nickname||"点击设置昵称"),l.a.createElement(m.AtIcon,{"value":"edit","size":"16","color":"ghostwhite"})),l.a.createElement(u.View,{"className":"fav-videos"},0===this.state.favVideos.length&&l.a.createElement(u.View,null,"TODO: 占位插画"),this.state.favVideos.map((function(e){return l.a.createElement(u.View,{"key":e.id,"className":"fav-video-card","style":{"width":"".concat(h,"px"),"height":"".concat(p,"px")},"onClick":function onClick(){f.default.navigateTo({"url":"/pages/video-detail/index?vid=".concat(e.id)})}},l.a.createElement(u.Video,{"src":e.src,"muted":!0,"showCenterPlayBtn":!1,"controls":!1}))}))),l.a.createElement(m.AtModal,{"isOpened":this.state.nicknameModalVisible},l.a.createElement(m.AtModalHeader,null,"修改昵称"),l.a.createElement(m.AtModalContent,null,l.a.createElement(m.AtInput,{"type":"text","placeholder":"请输入昵称","value":this.state.nicknameInput,"onChange":function onChange(t){return e.setState({"nicknameInput":t}),t}})),l.a.createElement(m.AtModalAction,null,l.a.createElement(u.Button,{"onClick":function onClick(){return e.setState({"nicknameModalVisible":!1})}},"取消"),l.a.createElement(u.Button,{"onClick":function onClick(){Object(v.a)(e.state.nicknameInput).then((function(){e.setState({"nicknameModalVisible":!1}),e.refreshUserInfo()})).catch((function(e){console.error("修改失败: ",e)}))}},"确定"))))}}]),Index}(d.Component)},"99":function(e,t,n){"use strict";n.d(t,"d",(function(){return fetchVideos})),n.d(t,"b",(function(){return fetchFavVideos})),n.d(t,"e",(function(){return likeVideo})),n.d(t,"f",(function(){return unlikeVideo})),n.d(t,"c",(function(){return fetchUserInfo})),n.d(t,"a",(function(){return editUserNickname}));var a=n(14),c=n.n(a),i=n(19),r=n(30),o=[{"id":"v-bear","isFav":!1,"src":"http://storage.jd.com/cjj-pub-images/bear.mp4"},{"id":"v-277004","isFav":!1,"src":"https://v-cdn.zjol.com.cn/277004.mp4"},{"id":"v-276986","isFav":!1,"src":"https://v-cdn.zjol.com.cn/276986.mp4"},{"id":"v-276991","isFav":!1,"src":"https://v-cdn.zjol.com.cn/276991.mp4"}];function fetchVideos(){var e=Object(r.getStorageSync)("fav-video-ids")||[],t=o.map((function(t){return t.isFav=e.includes(t.id),t}));return Promise.resolve(t)}function fetchFavVideos(){return Promise.resolve(o.filter((function(e){return(Object(r.getStorageSync)("fav-video-ids")||[]).includes(e.id)})))}function likeVideo(e){var t=Object(r.getStorageSync)("fav-video-ids")||[];return t.push(e),Object(r.setStorage)({"key":"fav-video-ids","data":t})}function unlikeVideo(e){var t=Object(r.getStorageSync)("fav-video-ids")||[],n=t.findIndex((function(t){return t===e}));if(-1!==n)return t.splice(n,1),Object(r.setStorage)({"key":"fav-video-ids","data":t})}function fetchUserInfo(){var e=Object(r.getStorageSync)("user-info@".concat("test"))||{};return Promise.resolve(e)}function editUserNickname(e){return _editUserNickname.apply(this,arguments)}function _editUserNickname(){return(_editUserNickname=Object(i.a)(c.a.mark((function _callee(e){var t;return c.a.wrap((function _callee$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetchUserInfo();case 2:return(t=n.sent).nickname=e,n.abrupt("return",Object(r.setStorage)({"key":"user-info@".concat("test"),"data":t}));case 5:case"end":return n.stop()}}),_callee)})))).apply(this,arguments)}}}]);